{% assign sep=include.separator | default: '' %}
{% assign dropdown=include.dropdown | defult: false %}
{% assign toggle=include.toggle | defult: false %}


{% if toggle == true %}
<button class="hamburger hamburger--slider menu-toggle" type="button" aria-label="Menu" role="button" aria-controls="navigation">
	<span class="hamburger-box">
		<span class="hamburger-inner"></span>
	</span>
</button>
{% endif %}
<nav class="{{ include.class }} menu">
	{% include menu-item.html ref='home' %}
	{{sep}}
	{% include menu-item.html ref='services' refs='design,smm,seo,advertising,branding,video' %}
	{{sep}}
	{% include menu-item.html ref='blog' %}
	{{sep}}
	{% include menu-item.html ref='projects' %}
	{{sep}}
	{% include menu-item.html refs='careers,internship' ref='team' %}
	{{sep}}
	{% include menu-item.html ref='contact' %}
	{% if include.nolang != true %}{{ sep }}
	{% if lang != 'en' %}
	<a class="menu-item" href="{% include t-link.html ref=page.ref lang='en' %}">
		<span class="menu-link menu-link--lang">{% include flag-en.html %} En</span>
	</a>
	{% else if lang != 'fr' %}
	<a class="menu-item" href="{% include t-link.html ref=page.ref lang='fr' %}">
		<span class="menu-link menu-link--lang">{% include flag-fr.html %} Fr</span>
	</a>
	{% endif %}
	{% endif %}
</nav>

{% if toggle == true %}
<script>
var menuToggles = document.querySelectorAll('.menu-toggle')
var menuToggle = menuToggles[menuToggles.length - 1]
menuToggle.addEventListener('touchstart', toggleMenu)

function toggleMenu () {
	if (menuToggle.classList.contains('menu-toggle--active')) {
		menuToggle.classList.remove('menu-toggle--active')
		menuToggle.classList.remove('is-active')

		hidedDDs()
	}
	else {
		menuToggle.classList.add('menu-toggle--active')
		menuToggle.classList.add('is-active')
	}
}

//FIXME: overinit dropdowns here
var ddToggles = document.querySelectorAll('.menu-item--dropdown')
for (var i = 0; i < ddToggles.length; i++) {
	initDD(ddToggles[i])
}

function initDD (ddToggle) {
	if (ddToggle.getAttribute('data-dropdown')) return;
	ddToggle.setAttribute('data-dropdown', true);
	ddToggle.addEventListener('touchend', function () {
		hidedDDs(ddToggle)

		if (ddToggle.classList.contains('menu-item--opened')) {
			ddToggle.classList.remove('menu-item--opened')
		}
		else {
			ddToggle.classList.add('menu-item--opened')
		}
	})
}

function hidedDDs (ddToggle) {
	var dds = document.querySelectorAll('.menu-item--opened')

	for (var j = 0; j < dds.length; j++) {
		if (dds[j] !== ddToggle) {
			dds[j].classList.remove('menu-item--opened')
		}
	}
}

</script>
{% endif %}
